{% extends 'base.html' %}
{% block title %}Randevu Detayı - {{ appointment.title }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            
            <div class="card border-0 shadow-lg overflow-hidden">
                <div class="card-header p-4 text-white {% if appointment.status.name == 'Cancelled' %}bg-danger{% elif appointment.status.name == 'Completed' %}bg-success{% else %}bg-primary{% endif %}">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-1 opacity-75">Randevu Detayı</h5>
                            <h2 class="mb-0 fw-bold">{{ appointment.title }}</h2>
                        </div>
                        <div class="text-end">
                            <i class="fa-solid fa-calendar-day fa-3x opacity-25"></i>
                        </div>
                    </div>
                </div>

                <div class="card-body p-5">
                    
                    <div class="row g-4 mb-5">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center p-3 rounded bg-light">
                                <div class="bg-white p-3 rounded-circle shadow-sm me-3 text-primary">
                                    <i class="fa-solid fa-user-doctor fa-xl"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block fw-bold">DOKTOR</small>
                                    <h5 class="mb-0 text-dark">{{ appointment.doctor.name }}</h5>
                                    <span class="badge bg-info text-dark mt-1">{{ appointment.doctor.speciality }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center p-3 rounded bg-light">
                                <div class="bg-white p-3 rounded-circle shadow-sm me-3 text-primary">
                                    <i class="fa-solid fa-clock fa-xl"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block fw-bold">TARİH & SAAT</small>
                                    <h5 class="mb-0 text-dark">{{ appointment.date|date:"d F Y" }}</h5>
                                    <span class="text-primary fw-bold">{{ appointment.date|date:"l" }} - {{ appointment.date|date:"H:i" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="fw-bold text-muted mb-3">ŞİKAYET / AÇIKLAMA</label>
                        <div class="p-4 rounded border-start border-4 border-primary bg-light">
                            <p class="mb-0 lead" style="font-size: 1.1rem;">
                                {{ appointment.description }}
                            </p>
                        </div>
                    </div>

                    {% if appointment.document %}
                    <div class="mb-5">
                        <label class="fw-bold text-muted mb-3">YÜKLENEN DOSYA / RAPOR</label>
                        <div class="p-3 bg-white rounded border d-flex align-items-center shadow-sm">
                            <i class="fa-solid fa-file-contract fa-2x text-danger me-3"></i>
                            <div>
                                <h6 class="mb-1 fw-bold text-dark">Rapor veya Görüntü Dosyası</h6>
                                <a href="{{ appointment.document.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="fa-solid fa-download me-1"></i> Dosyayı Görüntüle / İndir
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    {% if appointment.prescription %}
                    <div class="mb-5">
                        <label class="fw-bold text-success mb-3 d-flex align-items-center">
                            <i class="fa-solid fa-file-prescription me-2 fa-lg"></i> ELEKTRONİK REÇETE
                        </label>
                        <div class="p-4 rounded border border-success bg-success bg-opacity-10 position-relative">
                            
                            <i class="fa-solid fa-prescription position-absolute end-0 top-0 m-3 text-success opacity-25 fa-3x"></i>

                            <div class="mb-4">
                                <h6 class="text-success fw-bold text-uppercase small mb-2">Tanı / Teşhis:</h6>
                                <div class="bg-white p-3 rounded border shadow-sm">
                                    {{ appointment.prescription.diagnosis }}
                                </div>
                            </div>
                            
                            <div>
                                <h6 class="text-success fw-bold text-uppercase small mb-2">İlaçlar ve Kullanım:</h6>
                                <div class="bg-white p-3 rounded border shadow-sm" style="font-family: 'Courier New', monospace; font-weight: 600; color: #333;">
                                    {{ appointment.prescription.medicines|linebreaks }}
                                </div>
                            </div>

                            <div class="mt-3 text-end">
                                <small class="text-muted fst-italic">
                                    <i class="fa-solid fa-user-doctor me-1"></i> Dr. {{ appointment.doctor.name }}
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <hr class="my-4 opacity-25">

                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary px-4 rounded-pill">
                            <i class="fa-solid fa-arrow-left me-2"></i>Geri Dön
                        </a>

                        <div class="d-flex gap-2 align-items-center">
                            <button onclick="window.print()" class="btn btn-outline-dark px-3 rounded-pill me-2" title="Yazdır">
                                <i class="fa-solid fa-print"></i>
                            </button>

                            {% if appointment.prescription %}
                                <a href="{% url 'generate_pdf' appointment.pk %}" class="btn btn-primary px-3 rounded-pill me-2" title="PDF Olarak İndir">
                                    <i class="fa-solid fa-file-pdf me-2"></i> PDF İndir
                                </a>
                            {% endif %}
                        

                            {% if appointment.status.name == 'Completed' %}
                                <span class="badge bg-success px-3 py-2 rounded-pill">
                                    <i class="fa-solid fa-check-double me-1"></i> Tamamlandı
                                </span>
                            
                            {% elif appointment.status.name == 'Cancelled' %}
                                <span class="badge bg-danger px-3 py-2 rounded-pill">
                                    <i class="fa-solid fa-ban me-1"></i> İptal Edildi
                                </span>

                            {% else %}
                                <a href="{% url 'appointment_update' appointment.pk %}" class="btn btn-warning text-dark px-4 rounded-pill">
                                    <i class="fa-solid fa-pen me-2"></i>Düzenle
                                </a>
                                <a href="{% url 'appointment_cancel' appointment.pk %}" class="btn btn-danger px-4 rounded-pill">
                                    <i class="fa-solid fa-ban me-2"></i>İptal Et
                                </a>
                            {% endif %}
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}